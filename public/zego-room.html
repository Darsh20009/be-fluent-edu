<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeFluent Meet</title>
    <style>
        #root { width: 100vw; height: 100vh; }
        body { margin: 0; overflow: hidden; background: #000; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>
    <script>
        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            const appId = parseInt(urlParams.get('appId'));
            const serverSecret = urlParams.get('serverSecret');
            const roomId = urlParams.get('roomId');
            const userId = urlParams.get('userId');
            const userName = urlParams.get('userName');
            const role = urlParams.get('role') || 'STUDENT';

            if (!appId || !serverSecret || !roomId || !userId || !userName) {
                console.error('Missing configuration');
                window.parent.postMessage({ type: 'zegoError', error: 'Missing configuration' }, '*');
                return;
            }

            const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(appId, serverSecret, roomId, userId, userName);
            const zp = ZegoUIKitPrebuilt.create(kitToken);

            const isAdmin = role === 'ADMIN' || role === 'TEACHER';

            zp.joinRoom({
                container: document.querySelector('#root'),
                scenario: {
                    mode: ZegoUIKitPrebuilt.VideoConference,
                },
                showScreenSharingButton: true,
                showUserList: true,
                showChatWindow: true,
                showRoomTimer: true,
                showMyCameraToggleButton: true,
                showMyMicrophoneToggleButton: true,
                showAudioVideoSettingsButton: true,
                showLayoutButton: true,
                showNonVideoUser: true,
                showTextChat: true,
                showUserList: true,
                layout: "Auto",
                showPreJoinView: true,
                onJoinRoom: () => {
                    window.parent.postMessage({ type: 'zegoJoined' }, '*');
                },
                onLeaveRoom: () => {
                    window.parent.postMessage({ type: 'zegoLeft' }, '*');
                },
                whiteboardConfig: {
                    showAddImageButton: isAdmin,
                },
                branding: {
                    logoURL: '/logo.png',
                },
                // Admin specific powers
                ...(isAdmin && {
                    showRemoveUserButton: true,
                    showTurnOffRemoteCameraButton: true,
                    showTurnOffRemoteMicrophoneToggleButton: true,
                })
            });
        };
    </script>
</body>
</html>
